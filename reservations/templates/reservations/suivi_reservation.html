{% extends "base_dashboard.html" %}

{% block dashboard_content %}
<h2>Suivi de votre réservation</h2>

<div class="card shadow-sm p-3">
  <h5>Réservation #{{ reservation.id }}</h5>
  <p><strong>Véhicule :</strong> {{ reservation.vehicule.marque }} {{ reservation.vehicule.modele }} ({{ reservation.vehicule.plaque_immatric }})</p>
  <p><strong>Service :</strong> {{ reservation.service.nom }}</p>
  <p><strong>Créneau :</strong> {{ reservation.heure_debut|date:"d/m/Y H:i" }} → {{ reservation.heure_fin|date:"H:i" }}</p>

  {% if reservation.employe %}
    <p><strong>Employé assigné :</strong> {{ reservation.employe.prenom }} {{ reservation.employe.nom }}</p>
  {% else %}
    <p><em>Aucun employé n’a encore été assigné.</em></p>
  {% endif %}

  <p>
    <strong>Statut :</strong>
    <span class="badge 
        {% if reservation.statut == 'terminee' %}bg-success
        {% elif reservation.statut == 'en_cours' %}bg-warning
        {% elif reservation.statut == 'assignee' %}bg-info text-dark
        {% elif reservation.statut == 'annulee' %}bg-danger
        {% else %}bg-secondary{% endif %}">
        {% if reservation.statut == 'terminee' and not reservation.evaluation %}
            <a href="{% url 'reservations:evaluer_reservation' reservation.id %}" class="btn btn-outline-primary mt-2">Évaluer le service</a>
        {% elif reservation.evaluation %}
            <p class="mt-2 text-success">✔ Service déjà évalué : {{ reservation.evaluation.note }}/5</p>
        {% endif %}
        
        {{ reservation.get_statut_display }}
    </span>
  </p>

  <a href="{% url 'reservations:reservations_client' %}" class="btn btn-outline-secondary mt-2">← Retour</a>
</div>
{% endblock %}
